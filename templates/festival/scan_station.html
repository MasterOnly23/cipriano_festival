{% extends "festival/base.html" %}
{% block title %}{{ title }} - Cipriano{% endblock %}
{% block body_class %}station-page mode-{{ mode|lower }}{% endblock %}
{% block content %}
<section class="panel station-panel">
  <h1>{{ title }}</h1>
  <p class="muted">Escanea QR o codigo (scanner USB + Enter). El input se mantiene enfocado.</p>
  {% if mode == "SALES" %}
  <p class="muted">Doble escaneo ventas: primero QR de mesero (W-XXXX), luego QR de pizza.</p>
  {% endif %}
  <p class="muted">Operador: <strong>{{ operator.username }}</strong></p>

  <div class="grid two">
    {% if mode == "SALES" %}
    <div class="result-card waiter-card">
      <div><strong>Mesero activo:</strong> <span id="activeWaiterName">-</span></div>
      <div><strong>Codigo:</strong> <span id="activeWaiterCode">-</span></div>
      <div><button id="clearWaiterBtn" type="button" class="btn btn-alt">Limpiar mesero activo</button></div>
    </div>
    <div class="result-card waiter-card">
      <div><strong>Pizza pendiente:</strong> <span id="pendingPizzaId">-</span></div>
      <div><button id="clearPendingBtn" type="button" class="btn btn-alt">Cancelar pendiente</button></div>
    </div>
    <label>
      PIN override (solo ventas)
      <input id="overridePin" type="password" placeholder="PIN admin" autocomplete="off">
    </label>
    {% endif %}
  </div>

  <label>
    Codigo/ID
    <input id="scanInput" class="scan-input" type="text" placeholder="Ej: {% if current_branding == 'BURGERS' %}D1-BUR-0001{% else %}D1-MUZ-0001{% endif %}" autocomplete="off" autocapitalize="characters" spellcheck="false">
  </label>
  <div class="camera-actions">
    <button id="openCameraBtn" type="button" class="btn">Abrir camara</button>
    <button id="closeCameraBtn" type="button" class="btn btn-alt hidden">Cerrar camara</button>
    <span id="cameraMsg" class="muted"></span>
  </div>

  <div id="cameraPanel" class="camera-panel hidden">
    <div id="nativeReaderWrap">
      <video id="cameraVideo" autoplay playsinline muted></video>
      <canvas id="cameraCanvas" class="hidden"></canvas>
    </div>
    <div id="qrReader" class="hidden"></div>
  </div>

  <div id="feedback" class="feedback neutral">Esperando scan...</div>

  <div class="result-card">
    <div><strong>ID:</strong> <span id="pizzaId">-</span></div>
    <div><strong>Sabor:</strong> <span id="pizzaFlavor">-</span></div>
    <div><strong>Precio:</strong> <span id="pizzaPrice">-</span></div>
    <div><strong>Estado:</strong> <span id="pizzaStatus" class="status-pill">-</span></div>
    <div><strong>Hora:</strong> <span id="pizzaTime">-</span></div>
  </div>
</section>

<script>
  window.STATION_MODE = "{{ mode }}";
  window.CURRENT_OPERATOR = "{{ operator.username }}";
</script>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="/static/festival/js/scan_station.js"></script>
{% endblock %}
